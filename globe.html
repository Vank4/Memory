<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Memory Globe</title>
    <style>
      html,
      body {
        margin: 0;
        overflow: hidden;
        background: #000;
      }

      canvas {
        display: block;
      }
      #loader {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #000;
        color: white;
        font-size: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        gap: 10px;
      }

      .heartbeat {
        font-size: 50px !important;
        animation: beat 1s infinite;
        display: inline-block;
      }

      @keyframes beat {
        0%,
        100% {
          transform: scale(1);
        }
        25% {
          transform: scale(1.2);
        }
        50% {
          transform: scale(1.4);
        }
        75% {
          transform: scale(1.2);
        }
      }
      #musicIcon {
        position: fixed;
        bottom: 30px;
        right: 30px;
        font-size: 40px;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.4);
        }
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div
      id="loveText"
      style="
        position: absolute;
        top: 20px;
        left: 30px;
        color: white;
        font-family: 'Dancing Script', cursive;
        font-size: 28px;
        z-index: 10;
        pointer-events: none;
      "
    ></div>

    <div id="loader">
      <span>ƒêang t·∫£i k·ªâ ni·ªám...</span>
      <span class="heartbeat">üíì</span>
    </div>
    <a href="./memory.html"><div id="musicIcon">üíñ</div></a>

    <audio id="bgMusic" autoplay loop muted>
      <source src="music/2.mp3" type="audio/mpeg" />
    </audio>

    <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
    <script>
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio); // Th√™m d√≤ng n√†y
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // üåç Qu·∫£ c·∫ßu trung t√¢m
      const globeGeo = new THREE.SphereGeometry(6, 32, 32);
      const globeMat = new THREE.MeshBasicMaterial({
        color: 0xffaaff,
        wireframe: true,
      });
      const globe = new THREE.Mesh(globeGeo, globeMat);
      scene.add(globe);

      // üñº ·∫¢nh k·ª∑ ni·ªám
      const rows = 2;
      const imagesPerRow = 32;
      const totalImages = rows * imagesPerRow;
      let loadedCount = 0;

      const radius = 10;
      const verticalOffsets = [0.4, -0.4];
      const loader = new THREE.TextureLoader();
      function tryLoadImage(index, x, y, z) {
        const baseName = `images/${index + 1}`;
        loader.load(
          `${baseName}.jpg`,
          (texture) => handleLoaded(texture, x, y, z),
          undefined,
          () => {
            // N·∫øu .jpg l·ªói th√¨ th·ª≠ .JPG
            loader.load(
              `${baseName}.JPG`,
              (texture) => handleLoaded(texture, x, y, z),
              undefined,
              handleError
            );
          }
        );
      }

      function handleLoaded(texture, x, y, z) {
        texture.anisotropy = renderer.capabilities.getMaxAnisotropy();
        const imgWidth = texture.image.width;
        const imgHeight = texture.image.height;
        const maxDimension = 8;
        let displayWidth, displayHeight;

        if (imgWidth > imgHeight) {
          displayWidth = maxDimension;
          displayHeight = (imgHeight / imgWidth) * maxDimension;
        } else {
          displayHeight = maxDimension;
          displayWidth = (imgWidth / imgHeight) * maxDimension;
        }

        const planeGeo = new THREE.PlaneGeometry(
          displayWidth / 10,
          displayHeight / 10
        );

        const planeMat = new THREE.MeshBasicMaterial({
          map: texture,
          side: THREE.DoubleSide,
          transparent: true,
          color: new THREE.Color(0.7, 0.7, 0.7),
        });

        const photo = new THREE.Mesh(planeGeo, planeMat);
        photo.position.set(x, y, z);
        photo.lookAt(0, 0, 0);
        scene.add(photo);

        loadedCount++;
        if (loadedCount === totalImages) {
          document.getElementById("loader").style.display = "none";
        }
      }

      function handleError() {
        loadedCount++;
        if (loadedCount === totalImages) {
          document.getElementById("loader").style.display = "none";
        }
      }

      for (let row = 0; row < rows; row++) {
        const angleStep = (2 * Math.PI) / imagesPerRow;
        const angleOffset = row === 1 ? angleStep / 2 : 0;

        for (let i = 0; i < imagesPerRow; i++) {
          const angle = i * angleStep + angleOffset;
          const x = radius * Math.cos(angle);
          const y = verticalOffsets[row];
          const z = radius * Math.sin(angle);
          const imgIndex = row * imagesPerRow + i;

          tryLoadImage(imgIndex, x, y, z);
        }
      }

      // üí¨ T·∫°o sprite text xinh
      function createTextSprite(message, color = "#fff") {
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        const fontSize = 24;
        context.font = `700 ${fontSize}px 'Dancing Script'`;
        const textWidth = context.measureText(message).width;
        canvas.width = textWidth + 20;
        canvas.height = fontSize + 20;

        context.font = `700 ${fontSize}px 'Dancing Script'`;
        context.fillStyle = color;
        context.textBaseline = "middle";
        context.fillText(message, 10, canvas.height / 2);

        const texture = new THREE.CanvasTexture(canvas);
        const spriteMaterial = new THREE.SpriteMaterial({
          map: texture,
          transparent: true,
        });
        const sprite = new THREE.Sprite(spriteMaterial);
        sprite.scale.set(canvas.width / 100, canvas.height / 100, 1);
        return sprite;
      }

      // ‚ù§Ô∏è Danh s√°ch c√¢u ch·ªØ t√¨nh c·∫£m
      const loveMessages = [
        "Y√™u anh nhi·ªÅu l·∫Øm üíñ",
        "M√£i b√™n nhau nh√© üíë",
        "Ng·ªçt ng√†o nh∆∞ l·∫ßn ƒë·∫ßu üçì",
        "N·∫Øm tay em m√£i m√£i ü§ù",
        "Anh l√† thanh xu√¢n c·ªßa em üå∏",
        "C·∫£m ∆°n v√¨ ƒë√£ lu√¥n ·ªü b√™n üíå",
        "M·ªói ng√†y c√≥ anh l√† m·ªôt ng√†y ƒë·∫πp üåà",
        "H·∫°nh ph√∫c l√† c√≥ anh üòò",
        "T√¨nh y√™u c·ªßa em üíû",
        "Lu√¥n lu√¥n l√† anh üíì",
        "Anh l√† nh√† üè°",
        "Y√™u anh v√¥ ƒëi·ªÅu ki·ªán üß∏",
        "M·ªói kho·∫£nh kh·∫Øc l√† k·ª∑ ni·ªám ‚ú®",
        "Ch·ªâ c·∫ßn c√≥ anh th√¥i ‚òÄÔ∏è",
        "C√πng nhau ƒëi h·∫øt cu·ªôc ƒë·ªùi nh√© ü•∞",
        "B√¨nh y√™n l√† khi c√≥ anh b√™n c·∫°nh üåª",
        "Anh l√† tia n·∫Øng trong ƒë·ªùi em üåû",
        "T√¨nh y√™u l√†m th·∫ø gi·ªõi r·ª±c r·ª° h∆°n üåç",
        "Tr√°i tim n√†y l√† c·ªßa anh üíò",
        "G·ª≠i ng√†n n·ª• h√¥n ƒë·∫øn anh üíã",
        "Anh l√† ƒë·ªãnh m·ªánh c·ªßa em üå†",
        "Th·∫ø gi·ªõi n√†y ch·ªâ c·∫ßn c√≥ anh l√† ƒë·ªß üåé",
        "M·ªói √°nh nh√¨n c·ªßa anh ƒë·ªÅu l√†m tim em rung ƒë·ªông üíó",
        "Anh l√† m·∫£nh gh√©p ho√†n h·∫£o c·ªßa ƒë·ªùi em üß©",
        "B√™n anh, m·ªçi bu·ªìn phi·ªÅn tan bi·∫øn ‚òÅÔ∏è",
        "Anh l√† b·∫ßu tr·ªùi, em l√† v√¨ sao üåå",
        "Ch√∫ng ta l√† duy√™n tr·ªùi ƒë·ªãnh üîó",
        "Em y√™u anh ƒë·∫øn v√¥ t·∫≠n ‚ôæÔ∏è",
        "T√¨nh y√™u em d√†nh cho anh l√† m√£i m√£i üî•",
        "Anh l√†m tim em tan ch·∫£y m·ªói ng√†y üçØ",
        "D√π bao m√πa tr√¥i qua, v·∫´n ch·ªâ c√≥ anh üå¶Ô∏è",
        "Anh l√† l√Ω do em m·ªâm c∆∞·ªùi m·ªói s√°ng üåû",
        "T√¨nh y√™u l√† khi em c√≥ anh b√™n c·∫°nh üíì",
        "Em nh·ªõ anh m·ªói gi√¢y ph√∫t tr√¥i qua ‚è≥",
        "Em s·∫Ω m√£i b√™n anh, d·∫´u th·ªùi gian ƒë·ªïi thay ‚è∞",
        "Anh l√† ng·ªçn l·ª≠a s∆∞·ªüi ·∫•m tr√°i tim em üî•",
        "Ch·ªâ c·∫ßn c√≥ anh, em c√≥ t·∫•t c·∫£ üíØ",
        "Y√™u anh l√† ƒëi·ªÅu ng·ªçt ng√†o nh·∫•t em t·ª´ng bi·∫øt üç¨",
        "Anh l√† nh·ªãp ƒë·∫≠p trong tr√°i tim em üíì",
        "C√πng nhau vi·∫øt n√™n chuy·ªán t√¨nh c·ªï t√≠ch ‚ú®",
        "Anh l√† ng√¥i sao s√°ng nh·∫•t b·∫ßu tr·ªùi ƒë√™m üåü",
        "M·ªói ng√†y v·ªõi anh l√† m·ªôt ph√©p m√†u üéá",
        "Em ch·∫≥ng c·∫ßn g√¨ kh√°c ngo√†i anh üíï",
        "Anh l√† l√Ω do em tin v√†o t√¨nh y√™u üíñ",
        "Y√™u anh l√† ƒëi·ªÅu ƒë√∫ng ƒë·∫Øn nh·∫•t ƒë·ªùi em ‚úîÔ∏è",
        "B√™n anh, em th·∫•y th·∫ø gi·ªõi th·∫≠t ƒë·∫πp üåç",
        "Anh l√† ng∆∞·ªùi duy nh·∫•t trong tim em ‚ù§Ô∏è",
        "Ch√∫ng ta sinh ra l√† ƒë·ªÉ d√†nh cho nhau üåô",
        "M·ªói k·ª∑ ni·ªám v·ªõi anh l√† b√°u v·∫≠t v√¥ gi√° üíé",
        "T√¨nh y√™u c·ªßa em d√†nh cho anh kh√¥ng c√≥ gi·ªõi h·∫°n üöÄ",
        "D√π ƒëi ƒë√¢u, em v·∫´n lu√¥n h∆∞·ªõng v·ªÅ anh üß≠",
        "Anh l√† t·∫•t c·∫£ th·∫ø gi·ªõi c·ªßa em üåè",
        "Anh l√†m cu·ªôc s·ªëng em r·ª±c r·ª° s·∫Øc m√†u üåà",
        "Em thu·ªôc v·ªÅ anh, m√£i m√£i ü•∫",
        "Ch·ªâ c·∫ßn ƒë∆∞·ª£c ·ªü b√™n anh l√† ƒë·ªß h·∫°nh ph√∫c ü•∞",
        "T·ª´ng h∆°i th·ªü em ƒë·ªÅu nh·ªõ anh üí®",
        "Anh l√† b√†i h√°t ru trong tr√°i tim em üé∂",
        "Em ch·∫≥ng th·ªÉ ng·ª´ng nghƒ© v·ªÅ anh üß†",
        "M·ªói c√°i √¥m c·ªßa anh l√† n∆°i an to√†n nh·∫•t ü§ó",
        "Tr√°i tim em ƒë·∫≠p theo nh·ªãp b∆∞·ªõc ch√¢n anh üíì",
        "Anh l√† n∆°i em mu·ªën v·ªÅ sau m·ªói m·ªèi m·ªát üè†",
        "Anh l√† vƒ©nh c·ª≠u trong ƒë·ªùi em ‚õÖ",
        "Th·∫ø gi·ªõi n√†y ƒë·∫πp h∆°n khi c√≥ anh b√™n c·∫°nh üí´",
        "Em say anh h∆°n c·∫£ r∆∞·ª£u üç∑",
        "T√¨nh y√™u em d√†nh cho anh nh∆∞ d√≤ng ch·∫£y kh√¥ng ng·ª´ng üåä",
        "Ch·∫°m v√†o anh l√† ch·∫°m v√†o b√¨nh y√™n üçÉ",
        "Anh l√† ∆∞·ªõc m∆° th√†nh hi·ªán th·ª±c c·ªßa em üí≠",
        "Anh l√† ng·ªçn h·∫£i ƒëƒÉng soi s√°ng ƒë·ªùi em üå†",
        "T√¨nh y√™u c·ªßa ch√∫ng ta l√† m√£i m√£i ‚è≥",
        "Anh l√† l√Ω do ƒë·ªÉ em c·ªë g·∫Øng m·ªói ng√†y üí™",
        "Anh l√† ng∆∞·ªùi em mong th·ª©c d·∫≠y c√πng m·ªói s√°ng üåû",
        "M·ªói kho·∫£nh kh·∫Øc b√™n anh l√† m√≥n qu√† üéÅ",
        "Tr√°i tim em g·ªçi t√™n anh m·ªói ƒë√™m üåô",
        "Y√™u anh h∆°n c·∫£ ng√¥n t·ª´ c√≥ th·ªÉ n√≥i üí¨",
        "D√π c√≥ chuy·ªán g√¨ x·∫£y ra, em v·∫´n ch·ªçn anh ‚ù§Ô∏è",
        "Anh l√† ƒëi·ªÅu ng·ªçt ng√†o nh·∫•t cu·ªôc s·ªëng n√†y üç∞",
        "Em t√¨m th·∫•y ch√≠nh m√¨nh trong m·∫Øt anh üëÅÔ∏è",
        "Ch·∫≥ng ai khi·∫øn em c∆∞·ªùi nh∆∞ anh üòä",
        "Anh l√† t√¨nh y√™u m√† em kh√¥ng bao gi·ªù mu·ªën m·∫•t üíî",
        "Em s·∫Ω b√™n anh, d√π c·∫£ th·∫ø gi·ªõi quay l∆∞ng üõ°Ô∏è",
        "Anh l√† n∆°i b√¨nh y√™n cu·ªëi c√πng c·ªßa em üõèÔ∏è",
        "Em mu·ªën vi·∫øt t√™n anh l√™n b·∫ßu tr·ªùi üíå",
        "Anh l√† m√πa xu√¢n trong l√≤ng em üåº",
        "Y√™u anh l√† th√≥i quen c·ªßa tim em ‚è±Ô∏è",
        "Tr√°i tim em kh√¥ng bi·∫øt c√°ch ng·ª´ng y√™u anh ü´Ä",
        "M·ªói √°nh nh√¨n c·ªßa anh ƒë·ªÅu l√† ph√©p m√†u ‚ú®",
        "Em kh√¥ng th·ªÉ t∆∞·ªüng t∆∞·ª£ng cu·ªôc s·ªëng thi·∫øu anh ‚ùå",
        "Anh l√† b√†i th∆° ƒë·∫πp nh·∫•t em t·ª´ng vi·∫øt ‚úçÔ∏è",
        "B√™n anh, em c·∫£m th·∫•y th·∫≠t s·ªëng ƒë·ªông üî•",
        "Ch√∫ng ta l√† ƒë·ªãnh m·ªánh c·ªßa nhau üíû",
        "Y√™u anh l√† h√†nh tr√¨nh em ch·∫≥ng bao gi·ªù m·ªèi m·ªát üö∂‚Äç‚ôÄÔ∏è",
        "Tr√°i tim em lu√¥n h∆∞·ªõng v·ªÅ anh nh∆∞ la b√†n üåê",
        "Em s·∫Ω l√† n∆°i b√¨nh y√™n c·ªßa anh m·ªói khi gi√¥ng b√£o qua üíí",
        "T√¨nh y√™u c·ªßa em d√†nh cho anh l√† b·∫•t di·ªát ü™∑",
      ];

      // üéÄ R·∫£i ƒë·ªÅu c√°c c√¢u xung quanh qu·∫£ c·∫ßu, ƒë·ªô cao ng·∫´u nhi√™n
      function addFloatingText(messages, count = 100) {
        const placedPositions = [];

        for (let i = 0; i < count; i++) {
          const msg = messages[i % messages.length];
          let position;
          let attempts = 0;

          do {
            // üëâ Ph√¢n b·ªë ng·∫´u nhi√™n g·∫ßn qu·∫£ c·∫ßu
            const u = Math.random();
            const v = Math.random();
            const theta = 2 * Math.PI * u;
            const phi = Math.acos(2 * v - 1);
            const r = 11 + Math.random(); // c√°ch m·∫∑t c·∫ßu kho·∫£ng 1 ƒë∆°n v·ªã

            const x = r * Math.sin(phi) * Math.cos(theta);
            const y = r * Math.cos(phi);
            const z = r * Math.sin(phi) * Math.sin(theta);

            position = new THREE.Vector3(x, y, z);
            attempts++;

            // Ki·ªÉm tra kh√¥ng b·ªã qu√° g·∫ßn ƒëi·ªÉm ƒë√£ c√≥
          } while (
            placedPositions.some((p) => p.distanceTo(position) < 1.5) &&
            attempts < 100
          );

          placedPositions.push(position);

          const color = `hsl(${Math.random() * 360}, 100%, 75%)`;
          const sprite = createTextSprite(msg, color);
          sprite.position.copy(position);
          sprite.lookAt(0, 0, 0);
          scene.add(sprite);
        }
      }

      addFloatingText(loveMessages, 30); // hi·ªÉn th·ªã 30 c√¢u ng·∫´u nhi√™n

      // üé• Camera setup
      camera.position.z = 15;

      function animate() {
        requestAnimationFrame(animate);
        globe.rotation.y += 0.003;
        scene.rotation.y += 0.001;
        renderer.render(scene, camera);
      }

      animate();

      window.addEventListener("resize", () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });

      // üå∏ Hi·ªáu ·ª©ng g√µ t·ª´ng ch·ªØ ·ªü g√≥c tr√™n tr√°i
      const textDiv = document.getElementById("loveText");
      let currentMsgIndex = 0;
      let charIndex = 0;
      let typingInterval;
      let delayAfterFinish = 2000;

      let isDeleting = false;

      function typeNextCharacter() {
        const currentMessage = loveMessages[currentMsgIndex];

        if (!isDeleting) {
          // G√µ t·ª´ng ch·ªØ, m·ªói ch·ªØ m·ªôt m√†u
          let html = "";
          for (let i = 0; i < charIndex; i++) {
            const hue = (i * 40 + currentMsgIndex * 20) % 360;
            html += `<span style="color: hsl(${hue}, 100%, 75%)">${currentMessage[i]}</span>`;
          }
          html += "<span style='color: white'>|</span>";
          textDiv.innerHTML = html;
          charIndex++;
          if (charIndex > currentMessage.length) {
            isDeleting = true;
            clearInterval(typingInterval);
            setTimeout(() => {
              typingInterval = setInterval(typeNextCharacter, 50); // x√≥a nhanh h∆°n
            }, 1500);
          }
        } else {
          // X√≥a t·ª´ng ch·ªØ
          if (charIndex >= 0) {
            textDiv.textContent = currentMessage.slice(0, charIndex) + "|";
            charIndex--;
          } else {
            // Khi ƒë√£ x√≥a xong th√¨ x√≥a c·∫£ ch·ªØ & d·∫•u |
            textDiv.textContent = "";
            isDeleting = false;
            currentMsgIndex = (currentMsgIndex + 1) % loveMessages.length;
            clearInterval(typingInterval);
            setTimeout(() => {
              charIndex = 0;
              typingInterval = setInterval(typeNextCharacter, 100); // g√µ l·∫°i ch·∫≠m
            }, 300);
          }
        }
      }

      typingInterval = setInterval(typeNextCharacter, 100);
      window.addEventListener("DOMContentLoaded", () => {
        const audio = document.getElementById("bgMusic");
        audio.muted = false;
        audio.play().catch((e) => console.warn("Kh√¥ng th·ªÉ ph√°t nh·∫°c:", e));
      });
    </script>
  </body>
</html>
